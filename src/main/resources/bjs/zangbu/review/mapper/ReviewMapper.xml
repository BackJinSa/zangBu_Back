<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bjs.zangbu.review.mapper.ReviewMapper">

    <select id="selectByBuilding" resultType="bjs.zangbu.review.dto.ReviewListResponse">
        SELECT
            review_id         AS reviewId,
            reviewer_nickname AS reviewerNickname,
            rank,
            DATE_FORMAT(created_at, '%Y-%m-%dT%H:%i:%s') AS createdAt
        FROM review
        WHERE building_id = #{buildingId}
        ORDER BY created_at DESC
            LIMIT #{offset}, #{limit}
    </select>

    <select id="countByBuilding" resultType="long">
        SELECT COUNT(*)
        FROM review
        WHERE building_id = #{buildingId}
    </select>

    <!-- 추가된 selectLatestReviewRank -->
    <select id="selectLatestReviewRank" resultType="int">
        SELECT rank
        FROM review
        WHERE building_id = #{buildingId}
        ORDER BY created_at DESC
            LIMIT 1
    </select>

</mapper>
