<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="bjs.zangbu.deal.mapper.DealMapper">

  <select id="getWaitingDealsWithChatRoom" resultMap="DealWithChatRoomMap">
    SELECT d.deal_id,
           d.chat_room_id,
           d.building_id,
           d.status,
           d.created_at,
           d.complex_id,

           b.price,
           b.building_name,
           b.house_type,
           b.sale_type,
           b.image_url,

           cl.address,

           c.consumer_nickname,
           c.seller_nickname

    FROM deal d
           JOIN chat_room c ON d.chat_room_id = c.chat_room_id
           JOIN building b ON d.building_id = b.building_id
           JOIN complex_list cl ON d.complex_id = cl.complex_id
    WHERE d.member_id = #{userId}


  </select>
  <select id="getAllDealByUserId" resultType="bjs.zangbu.deal.vo.Deal"></select>

  <resultMap id="DealWithChatRoomMap" type="bjs.zangbu.deal.dto.join.DealWithChatRoom">
    <id property="dealId" column="deal_id"/>
    <result property="chatRoomId" column="chat_room_id"/>
    <result property="buildingId" column="building_id"/>
    <result property="status" column="status"/>
    <result property="createdAt" column="created_at"/>

    <result property="price" column="price"/>
    <result property="buildingName" column="building_name"/>
    <result property="houseType" column="house_type"/>
    <result property="saleType" column="sale_type"/>
    <result property="imageUrl" column="image_url"/>
    <result property="address" column="address"/>

    <result property="consumerNickname" column="consumer_nickname"/>
    <result property="sellerNickname" column="seller_nickname"/>
  </resultMap>

</mapper>
