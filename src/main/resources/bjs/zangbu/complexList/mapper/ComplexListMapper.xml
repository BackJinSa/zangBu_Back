<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="bjs.zangbu.complexList.mapper.ComplexListMapper">
    <!-- 단지 정보 삽입 쿼리 -->
<insert id="createComplexList">
    INSERT INTO complex_list (
        res_type,
        complex_name,
        complex_no,
        sido,
        sigungu,
        si_code,
        eupmyeondong,
        transaction_id,
        address,
        zonecode,
        building_name,
        bname,
        dong,
        ho,
        roadName
    )
    VALUES (
               #{resType},
               #{complexName},
               #{complexNo},
               #{sido},
               #{sigungu},
               #{siCode},
               #{eupmyeondong},
               #{transactionId},
               #{address},
               #{zonecode},
               #{buildingName},
               #{bname},
               #{dong},
               #{ho},
               #{roadName}
           )
    <!--
    삽입 후 방금 생성된 complex_id 값을 가져와
    ComplexList 객체의 complexId 필드에 설정함
    -->
    <selectKey
            resultType="Long"
            keyProperty="complexId"
            keyColumn="complex_id"
            order="AFTER"
    >
        SELECT LAST_INSERT_ID()
    </selectKey>
</insert>
    <!-- 단지 정보 삽입 쿼리 -->
    <select id="getComplexNoByBuildingId" resultType="java.lang.String">
        SELECT cl.complex_no
        FROM complex_list cl
                 JOIN building b ON cl.complex_id = b.complex_id
        WHERE b.building_id = #{buildingId}
    </select>
    
    <!-- 건물 ID로 단지 ID 조회 -->
    <select id="selectComplexIdByBuildingId" resultType="java.lang.Long">
        SELECT cl.complex_id
        FROM complex_list cl
                 JOIN building b ON cl.complex_id = b.complex_id
        WHERE b.building_id = #{buildingId}
    </select>
    
    <!-- 단지 ID로 단지 정보 조회 -->
    <select id="selectById" resultType="bjs.zangbu.complexList.vo.ComplexList">
        SELECT 
            complex_id,
            res_type,
            complex_name,
            complex_no,
            sido,
            sigungu,
            si_code,
            eupmyeondong,
            transaction_id,
            address,
            zonecode,
            building_name,
            bname,
            dong,
            ho,
            roadName
        FROM complex_list
        WHERE complex_id = #{complexId}
    </select>
</mapper>
