<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bjs.zangbu.documentReport.mapper.BuildingRegisterKeysMapper">

    <resultMap id="BRKeysMap" type="bjs.zangbu.documentReport.vo.BuildingRegisterKeys">
        <id column="building_id" property="buildingId"/>
        <result column="issue_date" property="issueDate"/>
        <result column="issuer" property="issuer"/>
        <result column="address_lot" property="addressLot"/>
        <result column="address_road" property="addressRoad"/>
        <result column="complex_name" property="complexName"/>
        <result column="use_main" property="useMain"/>
        <result column="use_approval_date" property="useApprovalDate"/>
        <result column="site_area_m2" property="siteAreaM2"/>
        <result column="total_floor_area_m2" property="totalFloorAreaM2"/>
        <result column="building_coverage_ratio" property="buildingCoverageRatio"/>
        <result column="floor_area_ratio" property="floorAreaRatio"/>
        <result column="household_summary" property="householdSummary"/>
        <result column="seismic_applied" property="seismicApplied"/>
        <result column="seismic_capacity" property="seismicCapacity"/>
        <result column="violation_status" property="violationStatus"/>
        <result column="created_at" property="createdAt"/>
        <result column="updated_at" property="updatedAt"/>
    </resultMap>

    <select id="findByBuildingId" parameterType="long" resultMap="BRKeysMap">
        SELECT *
        FROM building_register_keys
        WHERE building_id = #{buildingId}
    </select>

    <insert id="upsert" parameterType="bjs.zangbu.documentReport.vo.BuildingRegisterKeys">
        INSERT INTO building_register_keys (building_id, issue_date, issuer,
                                            address_lot, address_road, complex_name,
                                            use_main, use_approval_date,
                                            site_area_m2, total_floor_area_m2, building_coverage_ratio,
                                            floor_area_ratio,
                                            household_summary, seismic_applied, seismic_capacity,
                                            violation_status, created_at, updated_at)
        VALUES (#{buildingId}, #{issueDate}, #{issuer},
                #{addressLot}, #{addressRoad}, #{complexName},
                #{useMain}, #{useApprovalDate},
                #{siteAreaM2}, #{totalFloorAreaM2}, #{buildingCoverageRatio}, #{floorAreaRatio},
                #{householdSummary}, #{seismicApplied}, #{seismicCapacity},
                #{violationStatus}, NOW(), NOW()) ON DUPLICATE KEY
        UPDATE
            issue_date =
        VALUES (issue_date), issuer =
        VALUES (issuer), address_lot =
        VALUES (address_lot), address_road =
        VALUES (address_road), complex_name =
        VALUES (complex_name), use_main =
        VALUES (use_main), use_approval_date =
        VALUES (use_approval_date), site_area_m2 =
        VALUES (site_area_m2), total_floor_area_m2 =
        VALUES (total_floor_area_m2), building_coverage_ratio =
        VALUES (building_coverage_ratio), floor_area_ratio =
        VALUES (floor_area_ratio), household_summary =
        VALUES (household_summary), seismic_applied =
        VALUES (seismic_applied), seismic_capacity =
        VALUES (seismic_capacity), violation_status =
        VALUES (violation_status), updated_at = NOW()
    </insert>

</mapper>
