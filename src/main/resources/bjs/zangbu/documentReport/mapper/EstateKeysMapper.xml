<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bjs.zangbu.documentReport.mapper.EstateKeysMapper">

    <resultMap id="EstateKeysMap" type="bjs.zangbu.documentReport.vo.EstateKeys">
        <id column="building_id" property="buildingId"/>
        <result column="publish_date" property="publishDate"/>
        <result column="office" property="office"/>
        <result column="formatted_address" property="formattedAddress"/>
        <result column="unit" property="unit"/>
        <result column="exclusive_area_m2" property="exclusiveAreaM2"/>
        <result column="land_share_ratio" property="landShareRatio"/>
        <result column="land_right_type" property="landRightType"/>
        <result column="owner_name_current" property="ownerNameCurrent"/>
        <result column="comm_unique_no" property="commUniqueNo"/>
        <result column="first_max_claim" property="firstMaxClaim"/>
        <result column="building_only_overall" property="buildingOnlyOverall"/>
        <result column="created_at" property="createdAt"/>
        <result column="updated_at" property="updatedAt"/>
    </resultMap>

    <select id="findByBuildingId" parameterType="long" resultMap="EstateKeysMap">
        SELECT *
        FROM estate_keys
        WHERE building_id = #{buildingId}
    </select>

    <insert id="upsert" parameterType="bjs.zangbu.documentReport.vo.EstateKeys">
        INSERT INTO estate_keys (building_id, publish_date, office, formatted_address, unit,
                                 exclusive_area_m2, land_share_ratio, land_right_type, owner_name_current,
                                 comm_unique_no, first_max_claim, building_only_overall, created_at, updated_at)
        VALUES (#{buildingId}, #{publishDate}, #{office}, #{formattedAddress}, #{unit},
                #{exclusiveAreaM2}, #{landShareRatio}, #{landRightType}, #{ownerNameCurrent},
                #{commUniqueNo}, #{firstMaxClaim}, #{buildingOnlyOverall}, NOW(), NOW()) ON DUPLICATE KEY
        UPDATE
            publish_date =
        VALUES (publish_date), office =
        VALUES (office), formatted_address =
        VALUES (formatted_address), unit =
        VALUES (unit), exclusive_area_m2 =
        VALUES (exclusive_area_m2), land_share_ratio =
        VALUES (land_share_ratio), land_right_type =
        VALUES (land_right_type), owner_name_current =
        VALUES (owner_name_current), comm_unique_no =
        VALUES (comm_unique_no), first_max_claim =
        VALUES (first_max_claim), building_only_overall =
        VALUES (building_only_overall), updated_at = NOW()
    </insert>

    <update id="updateSummaryFields">
        UPDATE estate_keys
        SET first_max_claim       = #{firstMaxClaim},
            building_only_overall = #{buildingOnlyOverall},
            updated_at            = NOW()
        WHERE building_id = #{buildingId}
    </update>

</mapper>
