<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="bjs.zangbu.documentReport.mapper.DocumentReportMapper">

  <!-- 분석 리포트 저장 - 저장 후 저장된 값 반환 -->
  <insert id="createDocumentReport"
    parameterType="bjs.zangbu.documentReport.vo.DocumentReport"
    useGeneratedKeys="true"
    keyProperty="reportId"
  >
    INSERT INTO document_report (comm_unique_no,
                                 deal_amount,
                                 deposit,
                                 monthly_rent,
                                 priority_dept,
                                 deposit_price,
                                 final_auction_price,
                                 remaining_deposit,
                                 res_user_num,
                                 is_trustee,
                                 trust_type,
                                 created_at,
                                 building_id,
                                 member_id,
                                 complex_id)
    VALUES (#{commUniqueNo},
            #{dealAmount},
            #{deposit},
            #{monthlyRent},
            #{priorityDept},
            #{depositPrice},
            #{finalAuctionPrice},
            #{remainingDeposit},
            #{resUserNum},
            #{isTrustee},
            #{trustType},
            #{createdAt},
            #{buildingId},
            #{memberId},
            #{complexId})
  </insert>

  <!-- 분석 리포트 조회  - 특정 reportId 에 대한 조회 -->
  <select id="getDocumentReportByReportId"
    parameterType="java.lang.Long"
    resultType="bjs.zangbu.documentReport.vo.DocumentReport">
    SELECT *
    FROM document_report
    WHERE report_id = #{reportId}
  </select>

  <!-- 분석 리포트 조회  - buildingId, userId 에 대한 최근 리포트 1개 조회 -->
  <select id="getDocumentReportByUserIdAndBuildingId"
    resultType="bjs.zangbu.documentReport.vo.DocumentReport">
    SELECT *
    FROM document_report
    WHERE member_id = #{memberId}
      AND building_id = #{buildingId}
    ORDER BY created_at DESC LIMIT 1
  </select>
</mapper>
