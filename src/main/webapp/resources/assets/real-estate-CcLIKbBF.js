import{d as c}from"./index-xsOzOzeH.js";var i={};const h=async s=>{try{console.log("🏢 실제 부동산 정보 API 호출:",s);const a=await u(s);if(a.success)return{success:!0,data:{availableDong:a.dong,availableHo:a.ho,availableArea:a.area,buildingInfo:a.buildingInfo,dataSource:"real_trade_api"}};const e=await g(s);if(e.success)return{success:!0,data:{availableDong:e.dong,availableHo:e.ho,availableArea:e.area,buildingInfo:e.buildingInfo,dataSource:"property_portal"}};const r=await p(s);return r.success?{success:!0,data:{availableDong:r.dong,availableHo:r.ho,availableArea:r.area,buildingInfo:r.buildingInfo,dataSource:"cached_data"}}:{success:!1,message:"실제 부동산 정보를 찾을 수 없습니다.",error:"NO_DATA_FOUND"}}catch(a){return console.error("🚨 실제 부동산 정보 조회 오류:",a),{success:!1,message:"부동산 정보 조회 중 오류가 발생했습니다.",error:a.message}}},u=async s=>{try{const a=await c.get("/real-estate/apartment-trade",{params:{LAWD_CD:s.regionCode,DEAL_YMD:new Date().getFullYear()+String(new Date().getMonth()+1).padStart(2,"0"),serviceKey:i.VUE_APP_MOLIT_API_KEY}});if(a.data&&a.data.response&&a.data.response.body){const r=(a.data.response.body.items.item||[]).filter(o=>o.아파트&&o.아파트.includes(s.buildingName));if(r.length>0){const o=new Set,d=new Set,l=new Set;return r.forEach(t=>{t.동&&o.add(t.동.toString()),t.호수&&d.add(t.호수.toString()),t.전용면적&&l.add(parseFloat(t.전용면적).toString())}),{success:!0,dong:Array.from(o).sort((t,n)=>parseInt(t)-parseInt(n)),ho:Array.from(d).sort(),area:Array.from(l).sort((t,n)=>parseFloat(t)-parseFloat(n)),buildingInfo:{name:s.buildingName,address:s.roadAddress,totalUnits:r.length,lastTradeDate:r[0].거래일}}}}return{success:!1}}catch(a){return console.error("국토교통부 API 호출 오류:",a),{success:!1}}},g=async s=>{try{const a=await c.post("/real-estate/portal-search",{buildingName:s.buildingName,address:s.roadAddress,sido:s.sido,sigungu:s.sigungu});if(a.data&&a.data.success){const e=a.data.data;return{success:!0,dong:e.availableDong||[],ho:e.availableHo||[],area:e.availableArea||[],buildingInfo:{name:e.buildingName,address:e.address,buildingType:e.buildingType,totalFloors:e.totalFloors,totalUnits:e.totalUnits,completionYear:e.completionYear}}}return{success:!1}}catch(a){return console.error("부동산 포털 API 호출 오류:",a),{success:!1}}},p=async s=>{try{const a=await c.get("/real-estate/cached-building",{params:{buildingName:s.buildingName,sido:s.sido,sigungu:s.sigungu}});if(a.data&&a.data.success){const e=a.data.data;return{success:!0,dong:e.dong||[],ho:e.ho||[],area:e.area||[],buildingInfo:e.buildingInfo||{}}}return{success:!1}}catch(a){return console.error("캐시된 데이터 조회 오류:",a),{success:!1}}};export{h as fetchBuildingInfo};
